---
title: "Data Science Project" 
author: "Manueal Zonon, Lucie Aracil, Gwendoline Viquesnel"
date: '`r format(Sys.Date(), "%B %d, %Y")`' # generate date automatically
output: 
  html_document:
   code_folding : "hide" # hide the code 
---

```{r, include=FALSE}
# Downloading require packages 
#install.packages('eurostat')
#install.packages('survival')
library(eurostat)
library(dplyr)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(lubridate)
library(car)
library(RMySQL)
library(survival)
library(mapproj)
library(mosaic)
library(scales)
library(grid)
library(ggrepel)

# Downloading and naming the data frame from eurostat
doc1 <- get_eurostat(id= "lfsi_emp_a", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc2 <- get_eurostat(id= "lfsa_ergaed", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc3 <- get_eurostat(id= "lfsa_eppgan", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc4 <- get_eurostat(id= "lfsa_etgar", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc5 <- get_eurostat(id= "une_rt_a", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc6 <- get_eurostat(id= "une_ltu_a", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc7<- get_eurostat(id= "demo_gind", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc8<- get_eurostat(id= "nama_10_gdp", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc9<- get_eurostat(id= "earn_gr_gpgr2", time_format = "date", filters = "none",
type = "code", cache = TRUE)   

# Check if there are missing values
any(is.na(doc1))
any(is.na(doc2))
any(is.na(doc3))
any(is.na(doc4))
any(is.na(doc5))
any(is.na(doc6))
any(is.na(doc7))
any(is.na(doc8))
any(is.na(doc9))

# Remove NA
doc2=na.omit(doc2)
doc3=na.omit(doc3)
doc4=na.omit(doc4)
doc6=na.omit(doc6)
doc7=na.omit(doc7)
doc8=na.omit(doc8)
doc9=na.omit(doc9)

# Check if the missing value are gone
sum(is.na(doc2)) 
sum(is.na(doc3)) 
sum(is.na(doc4)) 
sum(is.na(doc6)) 
sum(is.na(doc7)) 
sum(is.na(doc8)) 
sum(is.na(doc9)) 

# date format
doc1$time <- format(doc1$time, "%Y")
doc2$time <- format(doc2$time, "%Y")
doc3$time <- format(doc3$time, "%Y")
doc4$time <- format(doc4$time, "%Y")
doc5$time <- format(doc5$time, "%Y")
doc6$time <- format(doc6$time, "%Y")
doc7$time <- format(doc7$time, "%Y")
doc9$time <- format(doc9$time, "%Y")

# only the doc8 is not as date so we change it in date format before
class(doc8$time)
doc8$time=as.Date(doc8$time,"%Y-%m-%d")
doc8$time <- format(doc8$time,"%Y")

# filter to keep data from 2006 
doc1=doc1 %>% filter(time>=2006)
doc2=doc2 %>% filter(time>=2006)
doc3=doc3 %>% filter(time>=2006)
doc4=doc4 %>%filter(time>=2006)
# doc5=doc5 %>%filter(time>=2006)
doc6=doc6 %>%filter(time>=2006)
doc7=doc7 %>% filter(time>=2006)
doc8=doc8 %>% filter(time>=2006)
doc9=doc9 %>% filter(time>=2006)

# filter to keep data from 20-64 year old category
doc1=doc1%>% filter(age== "Y20-64")
doc2=doc2%>% filter(age== "Y20-64")
doc3=doc3%>% filter(age== "Y20-64")
doc4=doc4%>% filter(age== "Y20-64")
doc6=doc6%>% filter(age== "Y20-64")
doc5=doc5%>% filter(age== "TOTAL")

# delete age column
doc1=doc1%>% select(-"age")
doc2=doc2%>% select(-"age")
doc3=doc3%>% select(-"age")
doc4=doc4%>% select(-"age")
doc5=doc5%>% select(-"age")
doc6=doc6%>% select(-"age")

# we keep just PC (pourcentage) unit column
doc1=doc1%>% filter(unit== "PC_POP")
doc1=doc1%>% select(-"unit")
doc2=doc2%>% select(-"unit") # il n'y a que PC
doc3=doc3%>% select(-"unit")
doc9=doc9%>% select(-"unit")

# Rename columns, rename labels inside columns, suppress useless stuffs and rename documents

              ### Reminder supprimer total partout car ils dérangent quand on fait les graphiques et ils                          peuvent être calculé en additionnant H + F 

## doc 1 : PC_Act
doc1 <- doc1 %>% 
  rename(country=geo, category=indic_em) 
doc1$category <- car::recode(doc1$category,'"ACT"="Actif"')
doc1$category <- car::recode(doc1$category,'"EMP_LFS"="Total_Employment"')
PC_Act <- doc1 %>% 
  filter(category=="Actif") %>% 
  rename(PC_act=values) %>% 
  filter(sex !="T")

## doc 2 : PC_Emp 
doc2 <- doc2 %>% 
  rename(educ_level=isced11, country=geo, PC_emp=values)  %>%
  filter(educ_level !="NRP")
doc2$educ_level <- car::recode(doc2$educ_level,'"ED0-2"="low";"ED3_4"="Inter";"ED5-8"="high"')
PC_Emp <- doc2

## doc 3 : PC_Partime 
PC_Partime <- doc3 %>% 
  rename(country=geo, PC_parttime_onemp=values) %>% filter(citizen=="TOTAL")%>%
  select(-"citizen")

## doc 4 : PC_Temp 
doc4 <- doc4 %>% 
  rename(country=geo, PC_emp=unit)  %>% 
  ### Column PC_emp diviser entre employement et part-time employement qu'est ce que ça veut dire ??? doit on garder   que part time ?? Où le % part time est construit par rapport au % employment ? 
  filter(reason !="NRP") 
  ### Filter TOTAL mais que pour la category TEMPORARY parce qu'on se fou de savoir que le total des cinq = 100% ? 
doc4$PC_emp <- car::recode(doc4$PC_emp,'
  "PC_SAL"="employment";"PC_SAL_TEMP"="Temporary"')
doc4$reason <- car::recode(doc4$reason,'
  "INVTMP"="NocoulJob";"WANTTMP"="NowantJob"')
PC_Temp <- doc4

## doc 5 : PC_Unemp 
### pourquoi pas le supprimer ??? on peut calculer % unemp grâce à emp ? 
PC_Unemp <- doc5 %>% 
  rename(country=geo, PC_unemp=unit) %>% 
  filter(PC_unemp !="THS_PER", PC_unemp !="PC_POP") %>% ### def chomage = unemp / pop active
  select(-PC_unemp) %>% 
  rename(PC_unemp=values)

## doc 6 : PC_Ltunemp 
PC_Ltunemp <- doc6 %>% 
  rename(country=geo, PC_unemp=values) %>% 
  filter(unit !="THS_PER") %>% 
  select(-indic_em)

## doc 7 : Pop_evol 
doc7$indic_de <- car::recode(doc7$indic_de,'"JAN"="T";"MJAN"="M";"FJAN"="F"')
doc7 <- doc7  %>%  filter(indic_de %in% c("T","M", "F"))
Pop_evol <- doc7

## doc 8 : GDPandVA 
GDPandVA <- doc8  %>%  
  rename(country=geo) %>% 
  filter(na_item %in% c("B1GQ","B1G"))  %>%  
  filter(unit == "CP_MEUR")

## doc 9 : PC_Gapaid 
### Voir quoi faire de la colonne nace_r2????
PC_Gapaid <- doc9 %>% 
  rename(country=geo, PC_gap=values)
PC_Gapaid2 <- PC_Gapaid %>% 
  group_by(country, time) %>%
  summarise(mean_gappaid_percountry = mean(PC_gap))

```

## Comparative study of the state of gender equality in the labour market between European countries

### Intro 

### Partie 1: Activity rate evolution and difference 

#### Evolution of activity rate in Europe from 2006 to 2018: Man VS. Woman

```{r,Activity Rate a}

###### I a) Evolution of activity rate in UE of 28, between woman & man

# Activity rate of European woman in 
# a data frame with all the annotation info

ARF06=PC_Act %>% filter(country =="EU28",sex=="F",time=="2006")%>% select(PC_act)
ARF18=PC_Act %>% filter(country =="EU28",sex=="F",time=="2018")%>% select(PC_act)
ARM06=PC_Act %>% filter(country =="EU28",sex=="M",time=="2006")%>% select(PC_act)
ARM18=PC_Act %>% filter(country =="EU28",sex=="M",time=="2018")%>% select(PC_act)

# Create a text
grobF <- grobTree(textGrob(c(ARF06,ARF18), x=c(0.01,0.9) , y=c(0.45,0.5), hjust=0,
  gp=gpar(col="red", fontsize=10)))
grobM <- grobTree(textGrob(c(ARM06,ARM18), x=c(0.01,0.9) , y=c(0.9,0.95), hjust=0,
  gp=gpar(col="Blue", fontsize=10)))

PC_Act %>% 
  filter(country =="EU28") %>% group_by(sex)%>% ggplot(.,) +
  geom_line(aes(x=time,y=PC_act,colour=sex,group=sex),size=1) +  
  labs(title="Evolution of Activity   Rate between woman & men ") +
  xlab("time") + ylab("activity rate")+ ylim(40,90)+
  theme(axis.text.x = element_text(angle=38)) +
  annotation_custom(grobM)+annotation_custom(grobF)


```
The activity rate increase between 2006 and 2018 for both women and men overall. 
Generally, women always have an activity rate lower than the men. 
We can notice that 2011 is a turning point: Before 2011, the activity rate for men was stagnating around 83% while activity rate for women was increasing. After 2011, the activity rate for men start to slightly increase to reach 'r  '(calcul EUR28 men activity rate 2018) in 2018. Concerning, women activity rate after 2011, it keep increasing a bit faster than before 2011: Indeed, The Beta of the trend before 2011 was (calcul Beta slope EUR28 women avant 2011) while the Beta after 2011 was (calcul Beta slope EUR28 avant 2011).  Women activity rate finally reach (calcul EUR28 women activity rate 2018) in 2018. 
Despite, a positive evolution of the activity rate for women for the concerned period, the gap between men and women activity rate remain almost unchanged. In 2006, the difference in percentage between men and women activity rate was (calcul gap activity rate EUR28 in 2006 between men and women) while in 2018 this gap in percentage was (calcul gap activity rate EUR28 in 2018 between men and women). 

#### Gap activity rate 2018 in Europe

```{r,Activity rate b}
###### I b) Cartograme, Gap Activity Rate Zone UE

# Data pour gap activity rate
PC_GapFem= PC_Act %>% filter(sex=="F")
PC_GapFem=PC_GapFem %>% rename(f_act= PC_act) 
PC_GapFem=PC_GapFem%>%  select(f_act,time,country)
PC_GapMal= PC_Act %>% filter(sex=="M")
PC_GapMal=PC_GapMal%>%rename(m_act= PC_act) %>% select(m_act,time,country)
PC_ActGap=left_join(PC_GapFem,PC_GapMal,by=c('time','country'))

PC_ActGap$gap=PC_ActGap$m_act-PC_ActGap$f_act

# Mise en place pour cartogram
PC_ActGapTime=PC_ActGap
PC_ActGap=PC_ActGap %>% 
  filter(! country %in% c("EA17","EA18","EA19","EU15","EU28"))%>% 
  select(- f_act,m_act)%>%filter(time=="2018")

PC_ActGap <- PC_ActGap %>% 
  rename(CNTR_CODE=country) 

PC_ActGap$class=cut_to_classes(PC_ActGap$gap, n=10, style="equal", decimals=1)
geodata <- get_eurostat_geospatial(resolution = "60", nuts_level = "2", year = 2016)
map_data <- inner_join(geodata, PC_ActGap)

#cartogram 
ggplot(data=map_data) + geom_sf(aes(fill=class),color="dim grey",size=0.1)+
    scale_fill_brewer(palette = "RdBu") +
    guides(fill = guide_legend(reverse=T, title = "euro")) +
    labs(title="Gender Gap of Activity rate in European Country in 2018") +
    theme_light()  +
    coord_sf(xlim=c(-40,44), ylim=c(25,70))

```

Countries in red are those with the lowest gap of activity rate between woman and men. On the map above, we can see that the countries with the lowest gap of activity rate are mostly countries from the north of Europe : The scandinavian peninsula countries (Norway, Finland, Sweden, Denmark and Iceland), two other countries from the baltic region (Latvia and Lithuania) plus Portugal and Romania. The results concerning the Scandinavian countries are consistent with the expectations because scandinavian countries are known to be equalitarian on gender matter. However, it is a little more surprising for the other countries. Even more surprising the country with the lowest activity rate gap is ...(mettre code pour Romania) with … (mettre code pour %).  

The countries with the higher gap of activity rate are depicted in dark and light blue. The one with the higher gender gap is … (mettre code pour Turkey) with … (mettre code pour %). This is consistent because Turkey is a country where the major religion is Islam and usually islamic woman are not allowed to work (with some exceptions). But we will not used Turkey for further analysis because it is not within the European Union. The higher gender gap within european countries can be found in .... (mettre code pour Italia) with … (mettre code pour %) (société machiste ???). 

#### Correlation between the activity rate and the activity rate gap in 2006, 2010 and 2018 for all European countries

```{r,Activity rate c}

##### I c) Corrélation taux d'activité total & Gap taux d'activité in 2006-2010-2018

## Graphique
PC_Act_Gap_col1 <- doc1 %>% filter(sex=="T") %>% filter(category=="Actif") %>%select(values, time, country)
PC_Act_Gap_col2=PC_ActGapTime %>% select(gap, time, country)
PC_Act_Gap=inner_join(PC_Act_Gap_col1, PC_Act_Gap_col2, by=c('time','country'))

PC_Act_Gap=PC_Act_Gap %>% filter(! country %in% c("EA17","EA18","EA19","EU15","EU28")) %>%
  filter(time == c("2006", "2010", "2018"))

ggplot(data = PC_Act_Gap, aes(x=values, y=gap, color=country)) +
  geom_point() +
  geom_smooth(method = "lm", se=FALSE) + 
  facet_wrap(~time) 
## tendance général : plus le taux d'activité est haut et plus l'écart entre taux d'activité H et F est faible
#################### AJOUTER LEGENDES ET CHANGER NOM DES AXES

## Calculer coef de correlation 
cor(PC_Act_Gap$values, PC_Act_Gap$gap, method="pearson")
## -0,85 = fortement corrélé négativement (variable évolue sens inverse de l'autre)

## Outliers to identify (hors trend)

### Outliers 2006
PC_Act_Gap %>%
  filter(time == "2006") %>%
  filter(gap>30) %>%
  select(time, country, values, gap)
### MT, TR

### Outliers 2010
PC_Act_Gap %>%
  filter(time == "2010") %>%
  filter(gap>30) %>%
  select(time, country, values, gap)
### MT, TR

### Outliers 2018
PC_Act_Gap %>%
  filter(time == "2018") %>%
  filter(gap>30) %>%
  select(time, country, values, gap)
### No outliers, why ???
```

### Correlation between the activity rate gap and the GDP in 2006, 2010 and 2018 for all European countries

```{r, Activity rate d}

##### I d)Corrélation Gap activity rate and GDP in 2018

## Calculer coef de correlation 
cor(PC_Act_Gap$values, PC_Act_Gap$gap, method="pearson")

## Vérification graphique
PC_GDP_Gap_col1 <- GDPandVA %>% 
  filter(na_item=="B1G") %>% 
  select(values, time, country) %>% 
  filter(! country %in% c("EA","EA12", "EA19","EU15", "EU28", "EU27_2019")) 
  
PC_GDP_Gap_col2 <- PC_ActGapTime %>% 
    select(gap, time, country) %>% 
    filter(! country %in% c("EA17","EA18","EA19","EU15","EU28"))

PC_GDP_Gap=inner_join(PC_GDP_Gap_col1, PC_GDP_Gap_col2, by=c('time','country'))

PC_GDP_Gap=PC_GDP_Gap %>% filter(time == c("2006", "2010", "2018"))

ggplot(data = PC_GDP_Gap, aes(x=values, y=gap, color=country)) +
  geom_point() +
  geom_smooth(method = "lm", se=FALSE) +
   facet_wrap(~time) 

## Calculer coef de correlation 
cor(PC_GDP_Gap$values, PC_GDP_Gap$gap, method="pearson")
## 0,26 = faiblement corrélé positivement 
```
```{r, Activity rate e}

# Find the country with the lowest gap activity rate between woman & men  
mingap2018=min(PC_ActGap$gap) # LT lituania 3.8
PC_ActGap%>%filter(gap==mingap2018)%>%select(CNTR_CODE)


# Find the country with the higher woman activity rate  
maxgap2018=max(PC_ActGap$gap) # Turquey 43%
PC_ActGap%>%filter(gap==maxgap2018)%>%select(CNTR_CODE)

# Find the country with the higher woman activity  in Europe  
gap2018EU= PC_ActGap %>% 
  filter(! CNTR_CODE %in% c("EA17","EA18","EA19","EU15","EU28","TR","MK","MT"))
max2018UE=max(gap2018EU$gap) #20.6 Italy
gap2018EU%>%filter(gap==max2018UE)%>%select(CNTR_CODE)


# find the country  with the median gap activity rate

gapmoy=median(gap2018EU$gap) #9.5
gap2018EU%>% filter(gap==gapmoy)%>%select(CNTR_CODE) # BE,Belgium

# text for plot
li06=PC_ActGapTime%>%filter(time==2006,country=='LT')%>%select(gap)
li06=round(li06,2)
Lit <- grobTree(textGrob(c(li06,mingap2018), x=c(0.01,0.9) , y=c(0.2,0.12), hjust=0,
  gp=gpar(col="Blue", fontsize=10)))
it06=PC_ActGapTime%>%filter(time==2006,country=='IT')%>%select(gap)
Ita <- grobTree(textGrob(c(it06,max2018UE), x=c(0.01,0.9) , y=c(0.9,0.7), hjust=0,
  gp=gpar(col="Green", fontsize=10)))
be06=PC_ActGapTime%>%filter(time==2006,country=='BE')%>%select(gap)
Bel<- grobTree(textGrob(c(be06,gapmoy), x=c(0.01,0.9) , y=c(0.6,0.38), hjust=0,
  gp=gpar(col="Red", fontsize=10)))

# graph of the evolution of 3 country over time for gap activity rate
PC_ActGapTime %>% 
  filter(country %in%c("IT","BE","LT")) %>% group_by(country)%>% ggplot(.,) +
  geom_line(aes(x=time,y=gap,colour=country,group=country),size=1) +
  labs(title="Evolution of gap activity rate over time  ") + xlab("time") +
  ylab("gap paid") +
  scale_color_discrete(label= c("Belgium"," Italy", "Lithuania")) + theme_light() +
  theme(axis.text.x = element_text(angle=38))+ annotation_custom(Bel)+annotation_custom(Bel)+annotation_custom(Ita)+annotation_custom(Lit)


```



```{r, Unemployment Rate a}

##### II a) Evolution of unemployment over the time in EU
PC_UnempUE=PC_Unemp %>% 
  filter(country =="EU28") %>% filter(!sex%in%("T")) %>% group_by(sex)
ggplot(PC_UnempUE) +
   geom_line(aes(x=time,y=PC_unemp,group=sex,colour=sex),size=0.5) + labs(title="Evolution of Unemployent Rate between wooman & men ") + xlab("time") + ylab("Unemployment rate")+ ylim(5,15)+theme(axis.text.x = element_text(angle=45))+geom_vline(xintercept = 9,
                color = "purple", size=1.5) + theme_classic()+theme(axis.text.x = element_text(angle=38))

```


```{r, Parttime a}
##### IV a) Cartographie partime total

# cartographie Total


PC_Partimecarte=PC_Partime %>% 
  filter(! country %in% c("EA17","EA18","EA19","EU15","EU28")) %>%
  filter(sex=="T",time=="2018")

PC_Partimecarte$class = cut_to_classes(PC_Partimecarte$PC_parttime_onemp, n=5,
                                       style="equal", decimals=1)

geocart <- get_eurostat_geospatial(resolution = "60", output_class = "df")
geocart <- geocart %>% 
  rename(country =CNTR_CODE)
 
mapdatapartime <- PC_Partimecarte%>%
  inner_join(geocart, by = "country")

ggplot(mapdatapartime, aes(x = long, y = lat, group = group))+
  geom_polygon(aes(fill=class), color="grey", size = .1)+ 
  scale_fill_brewer(palette ="Set2") +
  labs(title="Precarity employment throughout Europe, 2017",
             fill="Part-time employment") + theme_light()+
  coord_map(xlim=c(-40,40), ylim=c(25,73))
```
```{r, Parttime b}

##### IV b) 3 graphs 
# Gap H - F

TabF=PC_Partime %>% filter(sex=="F") %>% rename(PC_PF= PC_parttime_onemp)%>% select(-"sex")
TabH=PC_Partime %>% filter(sex=="M") %>% rename(PC_PH= PC_parttime_onemp)%>% select(-"sex")
PartTime=left_join(TabF,TabH,by=c('country','time'))
PartTime$gap=PartTime$PC_PF-PartTime$PC_PH

# choose 3 country
PartTime2018=PartTime%>% filter(time=="2018")%>% filter(! country %in% c("EA17","EA18","EA19","EU15","EU28","ME","MK","TR")) 

# negative for Montenegro so Men are more precare than woman
# Country with the lowest precarity gap

minpt2018=min(PartTime2018$gap)# 0.1 
mincountrypt2018=PartTime2018%>%filter(gap==minpt2018)%>%select(country)
mincountrypt2018 # BG, Bulgaria # 0.4

# Country with the higher precarity  gap
maxpt2018=max(PartTime2018$gap)# 58.3
maxcountrypt2018=PartTime2018%>%filter(gap==maxpt2018)%>%select(country)
maxcountrypt2018 #NL Netherland 

# Country with the median gender paid gap
#medpt2018=median(PartTime2018$gap) #20.3 
#medcountpt=PartTime2018 %>% filter(gap==20.3)%>%select(country)
# medcountpt # Norway

# European gender paid gap
EUpt=PartTime%>%filter(country=="EU28",time=="2018")%>%select(gap)
EUpt# 22.8

# graph of the evolution of 3 country over time forpart time activity rate
PartTime %>% 
  filter(country %in%c("NO","BG","NL")) %>% group_by(country)%>% ggplot(.,) +
  geom_line(aes(x=time,y=gap,colour=country,group=country),size=1) +
  labs(title="Evolution of par ime gap activity rate over time  ") + xlab("time") +
  ylab("gap paid") +
  scale_color_discrete(label= c("Netherland","Norway", " Bulgaria")) + theme_light() +
  theme(axis.text.x = element_text(angle=38))

# correlation 
```


```{r, Temporary}
##### V a)

# How country have the hightest rate of woman that didn't want to find a job
# doc4 = PC_Temp

NowantF=PC_Temp%>%filter(time=="2018" & sex=="F"& reason=="NowantJob")
maxnowant=max(NowantF$values)
NowantF%>%filter(values==maxnowant) # Slovénie 46.5%

```


```{r, Gap Paid }

#### VI a)graph of the evolution og Gap paid in Europe 
PC_Gapaid2 %>% 
  filter(country == "EU28")%>% ggplot(.,) +
  geom_line (aes(x=time,y=mean_gappaid_percountry,group=1 ) ,size=2) + 
  labs(title="Evolution of gap paid over time in Europe  ") + xlab("time") +
  ylab("gap paid") +
  theme_light() + geom_vline(xintercept = 2, color = "purple", size=1.5) + 
  geom_vline(xintercept = 4 , color = "purple", size=1.5)
            
```
```{r}
# #### VI b) Cartogram mean gap paid by gender between european countries in 2017
 
datacart <- get_eurostat(id= "earn_gr_gpgr2", time_format = "date", filters = "none",
type = "code", cache = TRUE) %>% 
  filter(time == "2017-01-01") %>%
  group_by(geo) %>%
  summarise(mean_gappaid_percountry = mean(values)) %>%
  mutate(cat = cut_to_classes(mean_gappaid_percountry, n=7, decimals=1))
 
geocart <- get_eurostat_geospatial(resolution = "60", output_class = "df")
 
mapdata <- datacart %>%
  inner_join(geocart, by = "geo")
 
head(select(mapdata,geo,mean_gappaid_percountry,cat,long,lat,order,id))
 
ggplot(mapdata, aes(x = long, y = lat, group = group))+
  geom_polygon(aes(fill=cat), color="grey", size = .1)+ scale_fill_brewer(palette = "YlOrRd") +
  labs(title="Gap paid between men and women throughout Europe, 2017",
       subtitle="Avg. gap paid per country",
       fill="Gap paid (%)") + theme_light()+
  coord_map(xlim=c(-40,40), ylim=c(25,73))

```
```{r, Gap Paidb}

# filter PC_Gapaid2 for work on max min medium
PC_Gapaid22017=PC_Gapaid2%>% filter(time=="2017")

# Country with the lowest gender paid gap
minGP2017=min(PC_Gapaid22017$mean_gappaid_percountry)
mincountGP=PC_Gapaid22017 %>% filter(mean_gappaid_percountry==minGP2017)%>%select(country)
mincountGP # RO, Roumania # 4.73% ( puis Marlte Belgique)

# Country with the hogher gender paid gap
maxGP2017=max(PC_Gapaid22017$mean_gappaid_percountry)
maxcountGP=PC_Gapaid22017 %>% filter(mean_gappaid_percountry==maxGP2017)%>%select(country)
maxcountGP # EE,Estonia # 20%, Republique Tcheque Autriche 

# Country with the median gender paid gap
median(PC_Gapaid22017$mean_gappaid_percountry) #13.52 we don't find this in our data 
medcountGP=13.5
medcountGP=PC_Gapaid22017 %>% filter(mean_gappaid_percountry==13.5)%>%select(country)
medcountGP # Finland

# European gender paid gap
EUGP=PC_Gapaid22017%>%filter(country=="EU28")
EUGP # 16%

##### VI c)  graph of the evolution of 3 gap wages over tme

PC_Gapaid2 %>% 
  filter(country %in%c("FI","EE","RO")) %>% group_by(country)%>% ggplot(.,) +
  geom_line(aes(x=time,y=mean_gappaid_percountry ,colour=country,group=country),size=1) +
  labs(title="Evolution of gap paid over time  ") + xlab("time") + ylab("gap paid") +
  scale_color_discrete(label= c(" Estonia", "Finland", "Roumania")) + theme_light() +
  theme(axis.text.x = element_text(angle=38))
```

```


