---
title: "Gender equality in labour market doc"
author: "moi"
date: "27/10/2019"
output: html_document
---

```{r, include=FALSE}
# Downloading require packages 
#install.packages('eurostat')
library(eurostat)
library(dplyr)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(lubridate)
library(car)
```

```{r}
# Downloading and naming the data frame from eurostat
doc1 <- get_eurostat(id= "lfsi_emp_a", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc2 <- get_eurostat(id= "lfsa_ergaed", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc3 <- get_eurostat(id= "lfsa_eppgan", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc4 <- get_eurostat(id= "lfsa_etgar", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc5 <- get_eurostat(id= "une_rt_a", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc6 <- get_eurostat(id= "une_ltu_a", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc7<- get_eurostat(id= "demo_gind", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc8<- get_eurostat(id= "nama_10_gdp", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc9<- get_eurostat(id= "earn_gr_gpgr2", time_format = "date", filters = "none",
type = "code", cache = TRUE)

```

```{r}
# Check if there are missing values
any(is.na(doc1))
any(is.na(doc2))
any(is.na(doc3))
any(is.na(doc4))
any(is.na(doc5))
any(is.na(doc6))
any(is.na(doc7))
any(is.na(doc8))
any(is.na(doc9))
```
```{r}
# Remove NA
doc2=na.omit(doc2)
doc3=na.omit(doc3)
doc4=na.omit(doc4)
doc6=na.omit(doc6)
doc7=na.omit(doc7)
doc8=na.omit(doc8)
doc9=na.omit(doc9)
```

```{r}
# Check if the missing value are gone
sum(is.na(doc2)) 
sum(is.na(doc3)) 
sum(is.na(doc4)) 
sum(is.na(doc6)) 
sum(is.na(doc7)) 
sum(is.na(doc8)) 
sum(is.na(doc9)) 
```


```{r}
# date format
doc1$time <- format(doc1$time, "%Y")
doc2$time <- format(doc2$time, "%Y")
doc3$time <- format(doc3$time, "%Y")
doc4$time <- format(doc4$time, "%Y")
doc5$time <- format(doc5$time, "%Y")
doc6$time <- format(doc6$time, "%Y")
doc7$time <- format(doc7$time, "%Y")
doc9$time <- format(doc9$time, "%Y")


# only the doc8 is not as date so we change it in date format before
class(doc8$time)
doc8$time=as.Date(doc8$time,"%Y-%m-%d")
doc8$time <- format(doc8$time,"%Y")


# filtre
doc1=doc1 %>% filter(time>=2006)
doc2=doc2 %>% filter(time>=2006)
doc3=doc3 %>% filter(time>=2006)
doc4=doc4 %>%filter(time>=2006)
doc5=doc5 %>%filter(time>=2006)
doc6=doc6 %>%filter(time>=2006)
doc7=doc7 %>% filter(time>=2006)
doc8=doc8 %>% filter(time>=2006)
doc9=doc9 %>% filter(time>=2006)


doc1=doc1%>% filter(age== "Y20-64")
doc2=doc2%>% filter(age== "Y20-64")
doc3=doc3%>% filter(age== "Y20-64")
doc4=doc4%>% filter(age== "Y20-64")
doc6=doc6%>% filter(age== "Y20-64")
doc5=doc5%>% filter(age== "TOTAL")



# delete age column
doc1=doc1%>% select(-"age")
doc2=doc2%>% select(-"age")
doc3=doc3%>% select(-"age")
doc4=doc4%>% select(-"age")
doc5=doc5%>% select(-"age")
doc6=doc6%>% select(-"age")


# we keep just PC (pourcentage) unit column
doc1=doc1%>% filter(unit== "PC_POP")
doc1=doc1%>% select(-"unit")

doc2=doc2%>% select(-"unit") # il n'y a que PC
doc3=doc3%>% select(-"unit")
doc9=doc9%>% select(-"unit")

```
```{r}
# rename column 
doc1 = doc1 %>% 
  rename(Country =geo)# on peut mettre des virgules pour renomer les différentes colonne d'un même tableau

# renomer l'interieur des colonnes

doc1$indic_em <- car::recode(doc1$indic_em,
  '"ACT"="Actif"')
doc1$indic_em <- car::recode(doc1$indic_em,
  '"EMP_LFS"="Total_Employment"')
EmpAct=doc1
TA=doc1%>%filter(indic_em=="Actif")

# graphique europe 28 Actif ( femme homme total, evolution à travers le temps)

TA %>% group_by(Country)

ggplot(TA,aes(x=time,y=values,colour = sex))+geom_line()+ facet_wrap(.~Country)


doc2 = doc2%>% 
  rename(Educ = isced11)

doc2$Educ<- car::recode(doc2$Educ,'
  "ED0-2"="low";"ED3_4"="Inter";"ED5-8"="high"')

doc2=doc2 %>% filter(Educ !="NRP")


doc3=doc3%>% select(-"citizen")

doc4=doc4 %>% filter(reason !="NRP")
doc4 = doc4 %>% 
  rename(PC_emp =unit)
doc4$PC_emp <- car::recode(doc4$PC_emp,'
  "PC_SAL"="employment";"PC_SAL_TEMP"="Temporary"')
doc4$reason <- car::recode(doc4$reason,'
  "INVTMP"="NocoulJob";"WANTTMP"="NowantJob"')

doc5=doc5 %>% filter(unit !="THS_PER")

doc6=doc6 %>% filter(unit !="THS_PER")

doc7$indic_de <- car::recode(doc7$indic_de,'
  "JAN"="poptot";"MJAN"="pop_M";"FJAN"="pop_F";"NATGROWRT"="NAT_VAR";"CNMIGRAT"="Migr";"GROW"="VAR_POP"')

```


