---
title: "Gender equality in labour market doc"
author: "moi"
date: "27/10/2019"
output: html_document
---

```{r, include=FALSE}
# Downloading require packages 
#install.packages('eurostat')
library(eurostat)
library(dplyr)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(lubridate)
library(car)
library(RMySQL)
```

```{r}
# Downloading and naming the data frame from eurostat
doc1 <- get_eurostat(id= "lfsi_emp_a", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc2 <- get_eurostat(id= "lfsa_ergaed", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc3 <- get_eurostat(id= "lfsa_eppgan", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc4 <- get_eurostat(id= "lfsa_etgar", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc5 <- get_eurostat(id= "une_rt_a", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc6 <- get_eurostat(id= "une_ltu_a", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc7<- get_eurostat(id= "demo_gind", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc8<- get_eurostat(id= "nama_10_gdp", time_format = "date", filters = "none", type = "code", cache = TRUE)
doc9<- get_eurostat(id= "earn_gr_gpgr2", time_format = "date", filters = "none",
type = "code", cache = TRUE)
```

```{r}
# Check if there are missing values
any(is.na(doc1))
any(is.na(doc2))
any(is.na(doc3))
any(is.na(doc4))
any(is.na(doc5))
any(is.na(doc6))
any(is.na(doc7))
any(is.na(doc8))
any(is.na(doc9))
```

```{r}
# Remove NA
doc2=na.omit(doc2)
doc3=na.omit(doc3)
doc4=na.omit(doc4)
doc6=na.omit(doc6)
doc7=na.omit(doc7)
doc8=na.omit(doc8)
doc9=na.omit(doc9)
```

```{r}
# Check if the missing value are gone
sum(is.na(doc2)) 
sum(is.na(doc3)) 
sum(is.na(doc4)) 
sum(is.na(doc6)) 
sum(is.na(doc7)) 
sum(is.na(doc8)) 
sum(is.na(doc9)) 
```


```{r}
# date format
doc1$time <- format(doc1$time, "%Y")
doc2$time <- format(doc2$time, "%Y")
doc3$time <- format(doc3$time, "%Y")
doc4$time <- format(doc4$time, "%Y")
doc5$time <- format(doc5$time, "%Y")
doc6$time <- format(doc6$time, "%Y")
doc7$time <- format(doc7$time, "%Y")
doc9$time <- format(doc9$time, "%Y")
```

```{r}
# only the doc8 is not as date so we change it in date format before
class(doc8$time)
doc8$time=as.Date(doc8$time,"%Y-%m-%d")
doc8$time <- format(doc8$time,"%Y")
```

```{r}
# filter to keep data from 2006 
doc1=doc1 %>% filter(time>=2006)
doc2=doc2 %>% filter(time>=2006)
doc3=doc3 %>% filter(time>=2006)
doc4=doc4 %>%filter(time>=2006)
doc5=doc5 %>%filter(time>=2006)
doc6=doc6 %>%filter(time>=2006)
doc7=doc7 %>% filter(time>=2006)
doc8=doc8 %>% filter(time>=2006)
doc9=doc9 %>% filter(time>=2006)

# filter to keep data from 20-64 year old category
doc1=doc1%>% filter(age== "Y20-64")
doc2=doc2%>% filter(age== "Y20-64")
doc3=doc3%>% filter(age== "Y20-64")
doc4=doc4%>% filter(age== "Y20-64")
doc6=doc6%>% filter(age== "Y20-64")
doc5=doc5%>% filter(age== "TOTAL")

# delete age column
doc1=doc1%>% select(-"age")
doc2=doc2%>% select(-"age")
doc3=doc3%>% select(-"age")
doc4=doc4%>% select(-"age")
doc5=doc5%>% select(-"age")
doc6=doc6%>% select(-"age")

# we keep just PC (pourcentage) unit column
doc1=doc1%>% filter(unit== "PC_POP")
doc1=doc1%>% select(-"unit")
doc2=doc2%>% select(-"unit") # il n'y a que PC
doc3=doc3%>% select(-"unit")
doc9=doc9%>% select(-"unit")
```

```{r}
# Rename columns, rename labels inside columns, suppress useless stuffs and rename documents

              ### Reminder supprimer total partout car ils dérangent quand on fait les graphiques et ils                          peuvent être calculé en additionnant H + F 

## doc 1 : PC_Act
doc1 <- doc1 %>% 
  rename(country=geo, category=indic_em) 
doc1$category <- car::recode(doc1$category,'"ACT"="Actif"')
doc1$category <- car::recode(doc1$category,'"EMP_LFS"="Total_Employment"')
PC_Act <- doc1 %>% filter(category=="Actif")
PC_Act <- PC_Act %>% 
  rename(PC_act=values) 

## doc 2 : PC_Emp 
doc2 <- doc2 %>% 
  rename(educ_level=isced11, country=geo, PC_emp=values)  %>%
  filter(educ_level !="NRP")
doc2$educ_level <- car::recode(doc2$educ_level,'"ED0-2"="low";"ED3_4"="Inter";"ED5-8"="high"')
PC_Emp <- doc2

## doc 3 : PC_Partime 
PC_Partime <- doc3 %>% 
  rename(country=geo, PC_parttime_onemp=values) %>% 
  select(-"citizen")

## doc 4 : PC_Temp 
doc4 <- doc4 %>% 
  rename(country=geo, PC_emp=unit)  %>% 
  ### Column PC_emp diviser entre employement et part-time employement qu'est ce que ça veut dire ??? doit on garder   que part time ?? Où le % part time est construit par rapport au % employment ? 
  filter(reason !="NRP") 
  ### Filter TOTAL mais que pour la category TEMPORARY parce qu'on se fou de savoir que le total des cinq = 100% ? 
doc4$PC_emp <- car::recode(doc4$PC_emp,'
  "PC_SAL"="employment";"PC_SAL_TEMP"="Temporary"')
doc4$reason <- car::recode(doc4$reason,'
  "INVTMP"="NocoulJob";"WANTTMP"="NowantJob"')
PC_Temp <- doc4

## doc 5 : PC_Unemp 
### pourquoi pas le supprimer ??? on peut calculer % unemp grâce à emp ? 
PC_Unemp <- doc5 %>% 
  rename(country=geo, PC_unemp=unit) %>% 
  filter(PC_unemp !="THS_PER", PC_unemp !="PC_POP") %>% ### def chomage = unemp / pop active
  select(-PC_unemp) %>% 
  rename(PC_unemp=values)

## doc 6 : PC_Ltunemp 
PC_Ltunemp <- doc6 %>% 
  rename(country=geo, PC_unemp=values) %>% 
  filter(unit !="THS_PER") %>% 
  select(-indic_em)

## doc 7 : Pop_evol 
doc7$indic_de <- car::recode(doc7$indic_de,'"JAN"="T";"MJAN"="M";"FJAN"="F"')
doc7 <- doc7  %>%  filter(indic_de %in% c("T","M", "F"))
Pop_evol <- doc7

## doc 8 : GDPandVA 
GDPandVA <- doc8  %>%  
  filter(na_item %in% c("B1GQ","B1G"))  %>%  
  filter(unit == "CP_MEUR")

## doc 9 : PC_Gapaid 
### Voir quoi faire de la colonne nace_r2????
PC_Gapaid <- doc9 %>% 
  rename(country=geo, PC_gap=values)
```

```{r}
# Merge table 
dataframe <- inner_join(PC_Emp, PC_Partime, by = c("time", "country", "sex"))
### PROBLEM PCPARTIMEEMP x4-5 les mêmes valeurs
```

```{r}
# Rename label country (quand tous les tableaux seront mergé)
```

```{r}
# view relation between two variables
plot(PC_Act$sex, PC_Act$PC_act) 
plot(PC_Act$country, PC_Act$PC_act) 

plot(PC_Temp) 
plot(PC_Partime) 
plot(PC_Unemp) 
plot(PC_Ltunemp) 
plot(Pop_evol)
plot(GDPandVA)
plot(PC_Gapaid) 
```

```{r}
# histogram of a single variable
hist() 
```

spread(data, bare name of column containing keys, bare name of column containing values) : long to wide
separate(data set, name of the column to split into two, c(“variable1”, “variable2”), sep =”…” ): to separate into two columns

data_frameZ <- data_frameX %>%
      inner_join(data_frameY, by = c("variable1","variable2"))

```{r}
# Graph 28 states europe actif population (woman, man, total, evolution over y)
plot1 <- PC_Act %>% 
  filter(country =="EU28") %>% 
  group_by(sex) %>%
  ggplot(. ,) + geom_point(aes(x=time, y=PC_act,colour=sex)) + labs(title="Evolution of Activity Rate between wooman & men ") + xlab("time") + ylab("activity rate")
print(plot1)
```


